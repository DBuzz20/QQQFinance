<head></head>
<body >
<%=render "/header"%>

<div class="container">
<br>
<% if flash[:notice] %>
  <div class="alert alert-danger alert-dismissable">
    <%= flash[:notice] %>
  </div>
<% end %>
 <div class="row">
   <div class="col-12">
     <h1>Valore totale wallet:</h1>
     <div class="text-center"><h2 style="color:green" id="valore"> <%=@tot.round(2)%> $</h2></div>
   </div>
 </div>
 <hr>

 <form action="/wallet/movimenti" method='post' >

 <div class="row">
  <div class="col-4">
   <h2>aggiungi posizione:</h2>
  </div>
  <div class="col-4">
  <input list="brow" class="form-control me-2" type="search" name="isin" id="isin"placeholder="Ricerca ISIN" aria-label="Cerca" required>
  <datalist id="brow">
   <%@az.each do |i|%>
    <option value=<%=i.isin%>>
   <%end%>
  </datalist>
  </div>
  <div class="col-2">
   <input name='quantita' id='quantita' type='number' min='1' placeholder="Quantità" class='form-control' required>
  </div>
  <div class="col-2">
   <button type="submit" class="btn btn-primary">Aggiungi</button>
 </div> 
 </form>
 </div>

 <hr>
 <div class="row">
   <h1>Azioni detenute:</h1>
   <div class=" table-responsive">
     <table name="portafoglio" style="text-align:center" class="table text-black" id="tab" rules="rows">
       <tr>
       <th class="clickable" onclick="ordina(0)">Nome</th>
       <th class="clickable" onclick="ordina(1)">ISIN</th>
       <th class="clickable" onclick="ordina(2)">Paese</th>
       <th class="clickable" onclick="ordina(3)">Settore</th>
       <th class="clickable" onclick="ordina(4)">Quantità</th>
       <th class="clickable" onclick="ordina(5)">ValorePosizione</th>
       <tr></tr>
       </tr>
       <% i=0%>
       <%= while i<@azioni.length() do %>
       <tr><td><%=@azioni[i].nome%></td><td><%=@azioni[i].isin%></td><td><%=@azioni[i].paese%></td><td><%=@azioni[i].settore%></td><td><%=@quantita[i]%></td><td><%=(@azioni[i].prezzo * @quantita[i]).round(2)%>$</td><td><%= button_to 'rimuovi', delete_position_path(isin:@azioni[i].isin), method: :delete, class: "btn btn-primary btn-danger btn-sm", data: { confirm: 'Sei sicuro di voler rimuovere questa posizione?' } %></td></tr>
       <% i+=1 %>
       <%end %>
     </table>
    </div>
    <% if @tot==0%>
    <p class="text-center">Il tuo wallet è vuoto.<br>Aggiungine alcune utilizzando l'apposito tool che trovi qui sopra o nella pagina <a href=../screener>screener</a></p>
    <%end%>
  </div>
  <%if @tot!=0%>
  <%= button_to 'Svuota wallet', delete_wallets_path, method: :delete, class: "btn btn-primary btn-danger btn-sm", data: { confirm: 'Sei sicuro di voler eliminare l&#39 intero wallet? Tutte le modifiche andranno perse.'} %>
  <%end%>
</div>
<%=render '/footer'%>

<script>
function ordina(col) {
  var table, rows, switching, i, x, y, shouldSwitch;
  table = document.getElementById("tab"); // ID della tabella
  switching = true;
  while (switching) {
    switching = false;
    rows = table.rows;
    for (i = 1; i < (rows.length - 1); i++) {
      shouldSwitch = false;
      x = rows[i].getElementsByTagName("TD")[col];
      y = rows[i + 1].getElementsByTagName("TD")[col];
      if (isNaN(x.innerHTML)) {
        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
          shouldSwitch = true;
          break;
        }
      } else {
        if (parseFloat(x.innerHTML) < parseFloat(y.innerHTML)) {
          shouldSwitch = true;
          break;
        }
      }
    }
    if (shouldSwitch) {
      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
      switching = true;
    }
  }
}
</script>
</body>