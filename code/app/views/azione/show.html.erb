<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
    <%= render "/header"%>

    <%if(current_user)%>
        <div class="row pt-2">
            <h1 class="col-3 text-center"><%= @azione.nome %></h1>  
            <h4 class="col p-2"><%= @azione.isin %> </h4>
            <div class="col">   
                <form action="/wallet/movimenti" method='post' class="row" >
                    <input type="hidden" name="isin" id="isin" value="<%= @azione.isin %>" />
                    <div class="col">
                        <input name='quantita' id='quantita' type='number' min='1' placeholder="Quantità" class='form-control' required>
                    </div>
                    <div class="col">
                        <button type="submit" class="btn btn-primary">Aggiungi</button>
                    </div> 
                </form>
            </div>
        </div>
    <%end%>
    
    <p class="p-2 text-center">Il prezzo di quest'azione è <%= @azione.prezzo %>$</p>
    <div class="container-fluid row">
        <div class="col-6">
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Settore</th>
                    <th scope="col">Marketcap</th>
                    <th scope="col">Roe</th>
                    <th scope="col">Roa</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th scope="row"></th>
                    <td><%= @azione.settore %></td>
                    <td><%= @azione.marketcap %></td>
                    <td><%= @azione.roe%></td>
                    <td><%= @azione.roa %></td>
                </tr>
            </tbody>
        </table>
        </div>
        <div class="col-6">
            <div class="tradingview-widget-container">
                <div id="basic-area-chart-demo"></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
                    <script type="text/javascript">
                        new TradingView.widget(
                        {
                            "width": "100%",
                            "height": "300px",
                            "symbol": "<%=@azione.isin%>",
                            "interval": "D",
                            "timezone": "Etc/UTC",
                            "theme": "light",
                            "style": "3",
                            "locale": "it",
                            "toolbar_bg": "#f1f3f6",
                            "enable_publishing": false,
                            "allow_symbol_change": true,
                            "container_id": "basic-area-chart-demo"
                        }
                    );
                </script>
            </div>
        </div>
    </div>

    <div class="container">
        <h4><p ><%=@azione.comment.length()%> Commenti</p></h4>
        <ul class="list-group list-group-flush">
            <%@azione.comment.each do |commento|%>
                <li class="list-group-item ">
                    <div class="row">
                        <div class="col-1">
                            <%= image_tag "profilo.jpeg",class:"card-img-top "%>
                        </div>
                        <div class="col-10">
                            <div class="d-flex">
                                <p class="h5"><%=commento.user.username%></p> 
                                <%if(current_user)%>      
                                    <%if(current_user.id==commento.user_id)%>
                                    </p>
                                        <%=link_to "Elimina",comment_path(commento),data: {
                                            turbo_method: :delete,
                                            turbo_confirm: "Sei sicuro?"
                                        },class:"ms-3" %>
                                    </p>  
                                    <%end%>
                                <%end%>
                            </div>
                            <p><%=commento.commento%></p>
                        </div>
                    </div>
                </li>  
            <%end%>
        </ul>
        <%if(current_user)%>
            <h4><p>Lascia un commento</p></h4>
            <%= form_with(model: @commento) do |form| %>
                <div class="row m-2">
                    <%= form.hidden_field :user_id, value: current_user.id %>
                    <%= form.hidden_field :azione_id, value: @azione.id %>
                    <%= form.text_area :commento, size: "70x5" %>
                    <div class="m-2">
                        <%= form.submit %>
                    </div>
                </div>
            <%end%>
        <%end%>
    </div>
</body>

